--who needs comments 
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")


local CONFIG_FILE = "SPAWN_CONFIG.json"
local LOGO_URL = "https://i.ibb.co/NgcLLmpS/OIP-4030729546-QPq-Zs-Ve8lrk3trb-XPo-FY0w-Ha-Ha-removebg-preview.png"
local LOGO_FILE = "SPAWN_BRAND_ASSET.png"

local THEME = {
    Main        = Color3.fromRGB(18, 18, 18),      -- Deep Void
    Header      = Color3.fromRGB(24, 24, 24),      -- Reinforced Plating
    Accent      = Color3.fromRGB(0, 255, 128),     -- Spawn Green/Cyan
    Text        = Color3.fromRGB(240, 240, 240),   -- High Vis
    TextDim     = Color3.fromRGB(140, 140, 140),   -- Low Vis
    Stroke      = Color3.fromRGB(45, 45, 45),      -- Structural Lines
    Dropdown    = Color3.fromRGB(28, 28, 28),      -- Menu Background
    Input       = Color3.fromRGB(12, 12, 12)       -- Textbox Background
}


local Persistence = {}
local CurrentConfig = {
    Position = {X = 0.5, Y = 0.5},
    Toggles = {} :: {[string]: boolean},
    Sliders = {} :: {[string]: number},
    Dropdowns = {} :: {[string]: string},
    Textboxes = {} :: {[string]: string}, -- Added storage for text inputs
    Keybinds = {} :: {[string]: string}
}

function Persistence.Load()
    if isfile and isfile(CONFIG_FILE) then
        local s, r = pcall(function() return HttpService:JSONDecode(readfile(CONFIG_FILE)) end)
        if s and r then 
            for k, v in pairs(r) do CurrentConfig[k] = v end 
        end
    end
end

function Persistence.Save()
    if writefile then writefile(CONFIG_FILE, HttpService:JSONEncode(CurrentConfig)) end
end


local function GetBranding(): string
    if not (writefile and isfile and getcustomasset) then return "" end
    if isfile(LOGO_FILE) then return getcustomasset(LOGO_FILE) end
    
    local s, r = pcall(function() return game:HttpGet(LOGO_URL) end)
    if s and r then 
        writefile(LOGO_FILE, r)
        return getcustomasset(LOGO_FILE) 
    end
    return ""
end


local function CreateStroke(parent: GuiObject, thickness: number, transparency: number?)
    local s = Instance.new("UIStroke")
    s.Color = THEME.Stroke
    s.Thickness = thickness or 1
    s.Transparency = transparency or 0
    s.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    s.Parent = parent
    return s
end


local Spawn = {}

function Spawn.Create(title: string)
    Persistence.Load()

    -- [INIT]
    local Screen = Instance.new("ScreenGui")
    Screen.Name = "Spawn_Internal"
    Screen.ResetOnSpawn = false
    Screen.ZIndexBehavior = Enum.ZIndexBehavior.Global 
    
    -- Safe Parent
    if run_secure_function then 
        run_secure_function(function() Screen.Parent = CoreGui end) 
    else 
        pcall(function() Screen.Parent = CoreGui end) 
    end

    -- [MAIN HULL]
    local Main = Instance.new("Frame")
    Main.Name = "Hull"
    Main.Size = UDim2.fromOffset(550, 420)
    Main.BackgroundColor3 = THEME.Main
    Main.BorderSizePixel = 0
    Main.Parent = Screen

    if CurrentConfig.Position then
        Main.Position = UDim2.new(CurrentConfig.Position.X, 0, CurrentConfig.Position.Y, 0)
    end

    CreateStroke(Main, 1.5)

    
    local Header = Instance.new("Frame")
    Header.Size = UDim2.new(1, 0, 0, 36)
    Header.BackgroundColor3 = THEME.Header
    Header.BorderSizePixel = 0
    Header.Parent = Main

    local LogoAsset = GetBranding()
    local TitleX = 12

    if LogoAsset ~= "" then
        local Logo = Instance.new("ImageLabel")
        Logo.Size = UDim2.fromOffset(22, 22)
        Logo.Position = UDim2.new(0, 8, 0.5, -11)
        Logo.BackgroundTransparency = 1
        Logo.Image = LogoAsset
        Logo.ImageColor3 = THEME.Accent
        Logo.Parent = Header
        TitleX = 40
    end

    local Title = Instance.new("TextLabel")
    Title.Text = string.upper(title)
    Title.Font = Enum.Font.RobotoMono
    Title.TextSize = 15
    Title.TextColor3 = THEME.Text
    Title.Size = UDim2.new(1, -100, 1, 0)
    Title.Position = UDim2.new(0, TitleX, 0, 0)
    Title.BackgroundTransparency = 1
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.Parent = Header

    
    local TabStrip = Instance.new("ScrollingFrame")
    TabStrip.Size = UDim2.new(1, 0, 0, 32)
    TabStrip.Position = UDim2.new(0, 0, 0, 36)
    TabStrip.BackgroundColor3 = THEME.Main
    TabStrip.BorderSizePixel = 0
    TabStrip.ScrollBarThickness = 0
    TabStrip.AutomaticCanvasSize = Enum.AutomaticSize.X
    TabStrip.ScrollingDirection = Enum.ScrollingDirection.X
    TabStrip.Parent = Main

    local TabLayout = Instance.new("UIListLayout")
    TabLayout.FillDirection = Enum.FillDirection.Horizontal
    TabLayout.SortOrder = Enum.SortOrder.LayoutOrder
    TabLayout.Parent = TabStrip

    local Sep = Instance.new("Frame")
    Sep.Size = UDim2.new(1, 0, 0, 1)
    Sep.Position = UDim2.new(0, 0, 0, 68)
    Sep.BackgroundColor3 = THEME.Stroke
    Sep.BorderSizePixel = 0
    Sep.Parent = Main

    
    local PageContainer = Instance.new("Frame")
    PageContainer.Size = UDim2.new(1, 0, 1, -69)
    PageContainer.Position = UDim2.new(0, 0, 0, 69)
    PageContainer.BackgroundTransparency = 1
    PageContainer.ClipsDescendants = true
    PageContainer.Parent = Main

    
    local dragging, dragInput, dragStart, startPos
    Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = Main.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                    CurrentConfig.Position = {X = Main.Position.X.Scale, Y = Main.Position.Y.Scale}
                    Persistence.Save()
                end
            end)
        end
    end)
    Header.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then dragInput = input end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)


    local WindowAPI = {}
    local FirstTab = true

    function WindowAPI.Tab(name: string)
        local Btn = Instance.new("TextButton")
        Btn.Size = UDim2.new(0, 100, 1, 0)
        Btn.BackgroundColor3 = THEME.Main
        Btn.Text = string.upper(name)
        Btn.TextColor3 = THEME.TextDim
        Btn.Font = Enum.Font.SourceSansBold
        Btn.TextSize = 13
        Btn.BorderSizePixel = 0
        Btn.Parent = TabStrip

        local Indicator = Instance.new("Frame")
        Indicator.Size = UDim2.new(1, 0, 0, 2)
        Indicator.Position = UDim2.new(0, 0, 1, -2)
        Indicator.BackgroundColor3 = THEME.Accent
        Indicator.BorderSizePixel = 0
        Indicator.Visible = false
        Indicator.Parent = Btn

        local Page = Instance.new("ScrollingFrame")
        Page.Size = UDim2.new(1, 0, 1, 0)
        Page.BackgroundTransparency = 1
        Page.Visible = false
        Page.ScrollBarThickness = 2
        Page.ScrollBarImageColor3 = THEME.Accent
        Page.Parent = PageContainer

        local PLayout = Instance.new("UIListLayout")
        PLayout.Padding = UDim.new(0, 6)
        PLayout.SortOrder = Enum.SortOrder.LayoutOrder
        PLayout.Parent = Page

        local PPad = Instance.new("UIPadding")
        PPad.PaddingTop = UDim.new(0, 10)
        PPad.PaddingLeft = UDim.new(0, 10)
        PPad.PaddingRight = UDim.new(0, 10)
        PPad.Parent = Page

        local function Open()
            for _, t in pairs(TabStrip:GetChildren()) do
                if t:IsA("TextButton") then
                    TweenService:Create(t, TweenInfo.new(0.2), {TextColor3 = THEME.TextDim}):Play()
                    t.Frame.Visible = false
                end
            end
            for _, p in pairs(PageContainer:GetChildren()) do p.Visible = false end
            
            TweenService:Create(Btn, TweenInfo.new(0.2), {TextColor3 = THEME.Text}):Play()
            Indicator.Visible = true
            Page.Visible = true
        end
        Btn.MouseButton1Click:Connect(Open)

        if FirstTab then FirstTab = false; Open() end

        
        local CompAPI = {}

        
        function CompAPI.Label(text: string)
            local Frame = Instance.new("Frame")
            Frame.Size = UDim2.new(1, 0, 0, 26)
            Frame.BackgroundTransparency = 1
            Frame.Parent = Page
            
            local Text = Instance.new("TextLabel")
            Text.Text = text
            Text.Font = Enum.Font.RobotoMono
            Text.TextSize = 13
            Text.TextColor3 = THEME.TextDim
            Text.Size = UDim2.new(1, 0, 1, 0)
            Text.Position = UDim2.new(0, 12, 0, 0)
            Text.BackgroundTransparency = 1
            Text.TextXAlignment = Enum.TextXAlignment.Left
            Text.Parent = Frame
        end

        
        function CompAPI.Button(text: string, callback: () -> ())
            local Frame = Instance.new("TextButton")
            Frame.Size = UDim2.new(1, 0, 0, 32)
            Frame.BackgroundColor3 = Color3.fromRGB(24, 24, 24)
            Frame.Text = ""
            Frame.AutoButtonColor = false
            Frame.Parent = Page
            CreateStroke(Frame, 1, 0)

            local Label = Instance.new("TextLabel")
            Label.Text = text
            Label.Font = Enum.Font.RobotoMono
            Label.TextSize = 13
            Label.TextColor3 = THEME.Text
            Label.Size = UDim2.new(1, 0, 1, 0)
            Label.BackgroundTransparency = 1
            Label.TextXAlignment = Enum.TextXAlignment.Center
            Label.Parent = Frame

            
            Frame.MouseEnter:Connect(function()
                TweenService:Create(Label, TweenInfo.new(0.2), {TextColor3 = THEME.Accent}):Play()
                TweenService:Create(Frame.UIStroke, TweenInfo.new(0.2), {Color = THEME.Accent}):Play()
            end)
            
            Frame.MouseLeave:Connect(function()
                TweenService:Create(Label, TweenInfo.new(0.2), {TextColor3 = THEME.Text}):Play()
                TweenService:Create(Frame.UIStroke, TweenInfo.new(0.2), {Color = THEME.Stroke}):Play()
            end)

            Frame.MouseButton1Click:Connect(function()
                -- Visual click feedback
                TweenService:Create(Frame, TweenInfo.new(0.05), {BackgroundColor3 = Color3.fromRGB(35, 35, 35)}):Play()
                task.wait(0.05)
                TweenService:Create(Frame, TweenInfo.new(0.05), {BackgroundColor3 = Color3.fromRGB(24, 24, 24)}):Play()
                
                task.spawn(callback)
            end)
        end

        
        function CompAPI.Textbox(id: string, text: string, placeholder: string, callback: (string) -> ())
            -- Load saved text if available
            local savedText = CurrentConfig.Textboxes[id] or ""

            local Frame = Instance.new("Frame")
            Frame.Size = UDim2.new(1, 0, 0, 50) -- Taller to fit label + box
            Frame.BackgroundColor3 = Color3.fromRGB(24, 24, 24)
            Frame.Parent = Page
            CreateStroke(Frame, 1, 0)

            local Label = Instance.new("TextLabel")
            Label.Text = text
            Label.Font = Enum.Font.RobotoMono
            Label.TextSize = 13
            Label.TextColor3 = THEME.Text
            Label.Size = UDim2.new(1, 0, 0, 20)
            Label.Position = UDim2.new(0, 12, 0, 4)
            Label.BackgroundTransparency = 1
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.Parent = Frame

            local InputBox = Instance.new("TextBox")
            InputBox.Size = UDim2.new(1, -24, 0, 20)
            InputBox.Position = UDim2.new(0, 12, 0, 24)
            InputBox.BackgroundColor3 = THEME.Input
            InputBox.Text = savedText
            InputBox.PlaceholderText = placeholder
            InputBox.TextColor3 = THEME.Accent
            InputBox.PlaceholderColor3 = Color3.fromRGB(80, 80, 80)
            InputBox.Font = Enum.Font.RobotoMono
            InputBox.TextSize = 13
            InputBox.Parent = Frame
            
            local IStroke = CreateStroke(InputBox, 1, 0.5)

            
            InputBox.FocusLost:Connect(function(enterPressed)
                local val = InputBox.Text
                CurrentConfig.Textboxes[id] = val
                Persistence.Save()
                
                -- Highlight border briefly on save
                TweenService:Create(IStroke, TweenInfo.new(0.3), {Color = THEME.Accent}):Play()
                task.delay(0.3, function()
                    TweenService:Create(IStroke, TweenInfo.new(0.3), {Color = THEME.Stroke}):Play()
                end)
                
                callback(val)
            end)
            
            -- Initial Callback to set state
            if savedText ~= "" then
                task.spawn(function() callback(savedText) end)
            end
        end

        
        function CompAPI.Toggle(id: string, text: string, callback: (boolean) -> ())
            local state = CurrentConfig.Toggles[id] or false
            if state then task.spawn(function() callback(state) end) end

            local Frame = Instance.new("TextButton")
            Frame.Size = UDim2.new(1, 0, 0, 34)
            Frame.BackgroundColor3 = Color3.fromRGB(24, 24, 24)
            Frame.Text = ""
            Frame.AutoButtonColor = false
            Frame.Parent = Page
            CreateStroke(Frame, 1, 0)

            local Label = Instance.new("TextLabel")
            Label.Text = text
            Label.Font = Enum.Font.RobotoMono
            Label.TextSize = 13
            Label.TextColor3 = state and THEME.Text or THEME.TextDim
            Label.Size = UDim2.new(1, -50, 1, 0)
            Label.Position = UDim2.new(0, 12, 0, 0)
            Label.BackgroundTransparency = 1
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.Parent = Frame

            local SwitchBG = Instance.new("Frame")
            SwitchBG.Size = UDim2.fromOffset(30, 6)
            SwitchBG.Position = UDim2.new(1, -42, 0.5, -3)
            SwitchBG.BackgroundColor3 = Color3.fromRGB(12, 12, 12)
            SwitchBG.BorderSizePixel = 0
            SwitchBG.Parent = Frame
            CreateStroke(SwitchBG, 1, 0.5)

            local Ind = Instance.new("Frame")
            Ind.Size = UDim2.fromOffset(14, 4)
            Ind.Position = state and UDim2.new(1, -14, 0.5, -2) or UDim2.new(0, 0, 0.5, -2)
            Ind.BackgroundColor3 = state and THEME.Accent or THEME.TextDim
            Ind.BorderSizePixel = 0
            Ind.Parent = SwitchBG

            Frame.MouseButton1Click:Connect(function()
                state = not state
                
                local endPos = state and UDim2.new(1, -14, 0.5, -2) or UDim2.new(0, 0, 0.5, -2)
                local endCol = state and THEME.Accent or THEME.TextDim
                local txtCol = state and THEME.Text or THEME.TextDim

                TweenService:Create(Ind, TweenInfo.new(0.15), {Position = endPos, BackgroundColor3 = endCol}):Play()
                TweenService:Create(Label, TweenInfo.new(0.15), {TextColor3 = txtCol}):Play()
                
                CurrentConfig.Toggles[id] = state
                Persistence.Save()
                callback(state)
            end)
        end

        
        function CompAPI.Slider(id: string, text: string, min: number, max: number, default: number, callback: (number) -> ())
            local val = CurrentConfig.Sliders[id] or default
            
            local Frame = Instance.new("Frame")
            Frame.Size = UDim2.new(1, 0, 0, 46)
            Frame.BackgroundColor3 = Color3.fromRGB(24, 24, 24)
            Frame.Parent = Page
            CreateStroke(Frame, 1, 0)

            local Label = Instance.new("TextLabel")
            Label.Text = text
            Label.Font = Enum.Font.RobotoMono
            Label.TextSize = 13
            Label.TextColor3 = THEME.Text
            Label.Size = UDim2.new(1, 0, 0, 20)
            Label.Position = UDim2.new(0, 12, 0, 4)
            Label.BackgroundTransparency = 1
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.Parent = Frame

            local ValueLabel = Instance.new("TextLabel")
            ValueLabel.Text = tostring(val)
            ValueLabel.Font = Enum.Font.RobotoMono
            ValueLabel.TextSize = 13
            ValueLabel.TextColor3 = THEME.Accent
            ValueLabel.Size = UDim2.new(1, -12, 0, 20)
            ValueLabel.BackgroundTransparency = 1
            ValueLabel.TextXAlignment = Enum.TextXAlignment.Right
            ValueLabel.Parent = Frame

            local SlideBG = Instance.new("TextButton")
            SlideBG.Size = UDim2.new(1, -24, 0, 6)
            SlideBG.Position = UDim2.new(0, 12, 0, 30)
            SlideBG.BackgroundColor3 = Color3.fromRGB(12, 12, 12)
            SlideBG.AutoButtonColor = false
            SlideBG.Text = ""
            SlideBG.Parent = Frame
            CreateStroke(SlideBG, 1, 0.5)

            local Fill = Instance.new("Frame")
            Fill.Size = UDim2.new((val - min) / (max - min), 0, 1, 0)
            Fill.BackgroundColor3 = THEME.Accent
            Fill.BorderSizePixel = 0
            Fill.Parent = SlideBG

            local function Update(input)
                local sizeX = SlideBG.AbsoluteSize.X
                local posX = SlideBG.AbsolutePosition.X
                local percent = math.clamp((input.Position.X - posX) / sizeX, 0, 1)
                local newVal = math.floor(min + ((max - min) * percent))
                val = newVal
                ValueLabel.Text = tostring(val)
                Fill.Size = UDim2.new(percent, 0, 1, 0)
                CurrentConfig.Sliders[id] = val
                Persistence.Save()
                callback(val)
            end

            local sliding = false
            SlideBG.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    sliding = true
                    Update(input)
                end
            end)
            
            UserInputService.InputChanged:Connect(function(input)
                if sliding and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                    Update(input)
                end
            end)
            
            UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    sliding = false
                end
            end)
            
            task.spawn(function() callback(val) end)
        end

        
        function CompAPI.Dropdown(id: string, text: string, options: {string}, callback: (string) -> ())
            local selection = CurrentConfig.Dropdowns[id] or options[1]
            local isOpen = false

            local Frame = Instance.new("Frame")
            Frame.Size = UDim2.new(1, 0, 0, 38)
            Frame.BackgroundColor3 = Color3.fromRGB(24, 24, 24)
            Frame.ZIndex = 2 
            Frame.Parent = Page
            CreateStroke(Frame, 1, 0)

            local Label = Instance.new("TextLabel")
            Label.Text = text
            Label.Font = Enum.Font.RobotoMono
            Label.TextSize = 13
            Label.TextColor3 = THEME.Text
            Label.Size = UDim2.new(0.6, 0, 1, 0)
            Label.Position = UDim2.new(0, 12, 0, 0)
            Label.BackgroundTransparency = 1
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.Parent = Frame

            local DropBtn = Instance.new("TextButton")
            DropBtn.Size = UDim2.new(0.4, -12, 0, 24)
            DropBtn.Position = UDim2.new(0.6, 0, 0.5, -12)
            DropBtn.BackgroundColor3 = THEME.Dropdown
            DropBtn.Text = selection
            DropBtn.TextColor3 = THEME.Accent
            DropBtn.Font = Enum.Font.SourceSansBold
            DropBtn.TextSize = 13
            DropBtn.Parent = Frame
            CreateStroke(DropBtn, 1, 0.5)

            local List = Instance.new("ScrollingFrame")
            List.Visible = false
            List.Size = UDim2.new(1, 0, 0, 0) 
            List.Position = UDim2.new(0, 0, 1, 5)
            List.BackgroundColor3 = THEME.Dropdown
            List.BorderSizePixel = 0
            List.ZIndex = 10
            List.Parent = DropBtn
            
            local LStroke = CreateStroke(List, 1, 0)
            LStroke.Color = THEME.Accent

            local ListLayout = Instance.new("UIListLayout")
            ListLayout.SortOrder = Enum.SortOrder.LayoutOrder
            ListLayout.Parent = List

            for _, opt in ipairs(options) do
                local OptBtn = Instance.new("TextButton")
                OptBtn.Size = UDim2.new(1, 0, 0, 24)
                OptBtn.BackgroundColor3 = THEME.Dropdown
                OptBtn.BorderSizePixel = 0
                OptBtn.Text = opt
                OptBtn.TextColor3 = THEME.TextDim
                OptBtn.Font = Enum.Font.SourceSans
                OptBtn.TextSize = 13
                OptBtn.ZIndex = 10
                OptBtn.Parent = List
                
                OptBtn.MouseButton1Click:Connect(function()
                    selection = opt
                    DropBtn.Text = selection
                    CurrentConfig.Dropdowns[id] = selection
                    Persistence.Save()
                    
                    isOpen = false
                    TweenService:Create(List, TweenInfo.new(0.2), {Size = UDim2.new(1, 0, 0, 0)}):Play()
                    task.wait(0.2)
                    List.Visible = false
                    
                    callback(selection)
                end)
            end

            DropBtn.MouseButton1Click:Connect(function()
                isOpen = not isOpen
                if isOpen then
                    List.Visible = true
                    TweenService:Create(List, TweenInfo.new(0.2), {Size = UDim2.new(1, 0, 0, math.min(#options * 24, 100))}):Play()
                else
                    TweenService:Create(List, TweenInfo.new(0.2), {Size = UDim2.new(1, 0, 0, 0)}):Play()
                    task.wait(0.2)
                    List.Visible = false
                end
            end)
            
            task.spawn(function() callback(selection) end)
        end

        return CompAPI
    end

    -- [KEYBIND TOGGLE UI]
    local function ToggleUI(input)
        if input.KeyCode == Enum.KeyCode.RightControl then
            Screen.Enabled = not Screen.Enabled
        end
    end
    UserInputService.InputBegan:Connect(ToggleUI)

    return WindowAPI
end

return Spawn
