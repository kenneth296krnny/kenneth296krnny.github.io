--[[
    SPAWN FRAMEWORK v2.0 (Desktop Redesign)
    Author: Kenneth/Spawn
    Style: Modern Dark, Browser Tabs, Component Cards
]]

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")

local Spawn = {}

-- // THEME CONFIGURATION //
local Theme = {
    Main = Color3.fromRGB(30, 30, 30),        -- #1e1e1e (Window BG)
    TopBar = Color3.fromRGB(20, 20, 20),      -- #141414 (Tab Bar BG)
    TabActive = Color3.fromRGB(30, 30, 30),   -- Matches Main
    TabInactive = Color3.fromRGB(40, 40, 40), -- Slightly lighter
    Card = Color3.fromRGB(37, 37, 38),        -- #252526 (Component BG)
    Stroke = Color3.fromRGB(60, 60, 60),      -- Border Color
    TextMain = Color3.fromRGB(240, 240, 240),
    TextDim = Color3.fromRGB(160, 160, 160),
    Accent = Color3.fromRGB(0, 122, 204)      -- #007acc (VS Code Blue)
}

-- // UTILITIES //
local function Create(class, props)
    local instance = Instance.new(class)
    for k, v in pairs(props) do
        instance[k] = v
    end
    return instance
end

local function MakeDraggable(topbar, object)
    local dragging, dragInput, dragStart, startPos
    topbar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = object.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    topbar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            TweenService:Create(object, TweenInfo.new(0.05), {Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)}):Play()
        end
    end)
end

-- // FRAMEWORK CONSTRUCTOR //
function Spawn.Create(WindowName)
    local Library = {}
    
    -- 1. ScreenGui
    local ScreenGui = Create("ScreenGui", {
        Name = "SpawnUI_" .. math.random(1000,9999),
        Parent = CoreGui,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    })

    -- 2. Main Window (Rounded, Shadow)
    local MainFrame = Create("Frame", {
        Name = "MainFrame",
        Parent = ScreenGui,
        BackgroundColor3 = Theme.Main,
        Position = UDim2.new(0.5, -300, 0.5, -200),
        Size = UDim2.new(0, 600, 0, 450),
        BorderSizePixel = 0
    })
    
    Create("UICorner", { Parent = MainFrame, CornerRadius = UDim.new(0, 8) })
    Create("UIStroke", { Parent = MainFrame, Color = Color3.fromRGB(0,0,0), Thickness = 1, Transparency = 0.5 })

    -- Shadow
    local Shadow = Create("ImageLabel", {
        Name = "Shadow",
        Parent = MainFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, -15, 0, -15),
        Size = UDim2.new(1, 30, 1, 30),
        ZIndex = -1,
        Image = "rbxassetid://5554236805",
        ImageColor3 = Color3.fromRGB(0,0,0),
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(23,23,277,277)
    })

    -- 3. Unified Top Bar (The "Chrome" Tab Strip)
    local TopBar = Create("Frame", {
        Name = "TopBar",
        Parent = MainFrame,
        BackgroundColor3 = Theme.TopBar,
        Size = UDim2.new(1, 0, 0, 40),
        BorderSizePixel = 0
    })
    Create("UICorner", { Parent = TopBar, CornerRadius = UDim.new(0, 8) })
    
    -- Fix bottom corners of topbar so they don't round (to connect to body)
    local TopBarFiller = Create("Frame", {
        Parent = TopBar,
        BackgroundColor3 = Theme.TopBar,
        Size = UDim2.new(1, 0, 0, 10),
        Position = UDim2.new(0, 0, 1, -10),
        BorderSizePixel = 0
    })

    -- Tabs Container
    local TabsContainer = Create("Frame", {
        Name = "TabsContainer",
        Parent = TopBar,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 5), -- Offset for aesthetics
        Size = UDim2.new(1, -100, 1, -5)
    })
    
    local UIList = Create("UIListLayout", {
        Parent = TabsContainer,
        FillDirection = Enum.FillDirection.Horizontal,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, -5) -- Overlap tabs slightly
    })

    -- Window Controls (Close/Min)
    local Controls = Create("Frame", {
        Parent = TopBar,
        BackgroundTransparency = 1,
        Size = UDim2.new(0, 80, 1, 0),
        Position = UDim2.new(1, -80, 0, 0)
    })
    
    local CloseBtn = Create("TextButton", {
        Parent = Controls,
        BackgroundTransparency = 1,
        Text = "Ã—",
        TextColor3 = Theme.TextDim,
        TextSize = 24,
        Size = UDim2.new(0, 40, 1, 0),
        Position = UDim2.new(0.5, 0, 0, 0),
        Font = Enum.Font.GothamMedium
    })
    CloseBtn.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)

    -- 4. Content Area
    local ContentArea = Create("Frame", {
        Name = "ContentArea",
        Parent = MainFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 40),
        Size = UDim2.new(1, 0, 1, -40),
        ClipsDescendants = true
    })

    MakeDraggable(TopBar, MainFrame)

    -- // TAB SYSTEM //
    local Tabs = {}
    local FirstTab = true

    function Library.Tab(TabName)
        local TabObj = {}
        
        -- Tab Button (Trapezoid-ish simulation)
        local TabBtn = Create("TextButton", {
            Name = TabName,
            Parent = TabsContainer,
            BackgroundColor3 = Theme.TabInactive,
            Size = UDim2.new(0, 120, 1, 0),
            Text = "",
            AutoButtonColor = false,
            BorderSizePixel = 0
        })
        
        -- Tab Styling
        local TabCorner = Create("UICorner", { Parent = TabBtn, CornerRadius = UDim.new(0, 6) })
        local TabTitle = Create("TextLabel", {
            Parent = TabBtn,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            Text = TabName,
            TextColor3 = Theme.TextDim,
            Font = Enum.Font.GothamMedium,
            TextSize = 13,
            ZIndex = 2
        })
        
        -- The "Connector" (Hides the bottom border when active)
        local Connector = Create("Frame", {
            Parent = TabBtn,
            BackgroundColor3 = Theme.Main, -- Matches MainFrame
            Size = UDim2.new(1, 0, 0, 5),
            Position = UDim2.new(0, 0, 1, -2),
            BorderSizePixel = 0,
            Visible = false,
            ZIndex = 3
        })

        -- Page Container
        local Page = Create("ScrollingFrame", {
            Name = TabName.."_Page",
            Parent = ContentArea,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            CanvasSize = UDim2.new(0, 0, 0, 0),
            ScrollBarThickness = 2,
            ScrollBarImageColor3 = Theme.Accent,
            Visible = false,
            PaddingBottom = UDim.new(0, 20),
            TopImage = "rbxasset://textures/ui/Scroll/scroll-middle.png",
            BottomImage = "rbxasset://textures/ui/Scroll/scroll-middle.png"
        })
        
        local PageLayout = Create("UIListLayout", {
            Parent = Page,
            SortOrder = Enum.SortOrder.LayoutOrder,
            Padding = UDim.new(0, 12),
            HorizontalAlignment = Enum.HorizontalAlignment.Center
        })
        
        Create("UIPadding", { Parent = Page, PaddingTop = UDim.new(0, 20), PaddingBottom = UDim.new(0,20) })

        -- Auto-resize canvas
        PageLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            Page.CanvasSize = UDim2.new(0, 0, 0, PageLayout.AbsoluteContentSize.Y + 40)
        end)

        -- Activation Logic
        local function Activate()
            -- Deactivate all others
            for _, t in pairs(Tabs) do
                t.Btn.BackgroundColor3 = Theme.TabInactive
                t.Btn.ZIndex = 1
                t.Connector.Visible = false
                t.Title.TextColor3 = Theme.TextDim
                t.Page.Visible = false
                TweenService:Create(t.Btn, TweenInfo.new(0.2), {Size = UDim2.new(0, 120, 1, -4)}):Play() -- Inactive shrinks slightly
            end
            -- Activate self
            TabBtn.BackgroundColor3 = Theme.TabActive
            TabBtn.ZIndex = 5 -- Bring to front
            Connector.Visible = true
            TabTitle.TextColor3 = Theme.TextMain
            Page.Visible = true
            TweenService:Create(TabBtn, TweenInfo.new(0.2), {Size = UDim2.new(0, 120, 1, 0)}):Play()
        end

        TabBtn.MouseButton1Click:Connect(Activate)

        table.insert(Tabs, {Btn = TabBtn, Page = Page, Connector = Connector, Title = TabTitle})

        if FirstTab then
            Activate()
            FirstTab = false
        else
            -- Init inactive state
            TabBtn.Size = UDim2.new(0, 120, 1, -4)
            TabBtn.Position = UDim2.new(0,0,0,4)
        end

        -- // ELEMENTS //

        -- Section Label
        function TabObj.Label(Text)
            local LabelContainer = Create("Frame", {
                Parent = Page,
                BackgroundTransparency = 1,
                Size = UDim2.new(0.95, 0, 0, 30)
            })
            local TextLab = Create("TextLabel", {
                Parent = LabelContainer,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Text = string.upper(Text),
                TextColor3 = Theme.TextDim,
                Font = Enum.Font.GothamBold,
                TextSize = 11,
                TextXAlignment = Enum.TextXAlignment.Left
            })
            Create("Frame", { -- Divider Line
                Parent = LabelContainer,
                BackgroundColor3 = Theme.Stroke,
                Size = UDim2.new(1, 0, 0, 1),
                Position = UDim2.new(0, 0, 1, 0),
                BorderSizePixel = 0
            })
        end

        -- Toggle Component
        function TabObj.Toggle(Flag, Text, Callback)
            local Card = Create("Frame", {
                Parent = Page,
                BackgroundColor3 = Theme.Card,
                Size = UDim2.new(0.95, 0, 0, 50)
            })
            Create("UICorner", { Parent = Card, CornerRadius = UDim.new(0, 6) })
            Create("UIStroke", { Parent = Card, Color = Theme.Stroke, Thickness = 1 })

            local Title = Create("TextLabel", {
                Parent = Card,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 15, 0, 0),
                Size = UDim2.new(0.7, 0, 1, 0),
                Text = Text,
                TextColor3 = Theme.TextMain,
                Font = Enum.Font.GothamMedium,
                TextSize = 14,
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local ToggleBtn = Create("TextButton", {
                Parent = Card,
                BackgroundColor3 = Theme.TabInactive, -- Off color
                Position = UDim2.new(1, -65, 0.5, -12),
                Size = UDim2.new(0, 50, 0, 24),
                Text = "",
                AutoButtonColor = false
            })
            Create("UICorner", { Parent = ToggleBtn, CornerRadius = UDim.new(1, 0) })
            
            local Circle = Create("Frame", {
                Parent = ToggleBtn,
                BackgroundColor3 = Theme.TextMain,
                Size = UDim2.new(0, 18, 0, 18),
                Position = UDim2.new(0, 3, 0.5, -9)
            })
            Create("UICorner", { Parent = Circle, CornerRadius = UDim.new(1, 0) })

            local Toggled = false
            ToggleBtn.MouseButton1Click:Connect(function()
                Toggled = not Toggled
                
                local TargetPos = Toggled and UDim2.new(1, -21, 0.5, -9) or UDim2.new(0, 3, 0.5, -9)
                local TargetColor = Toggled and Theme.Accent or Theme.TabInactive
                
                TweenService:Create(Circle, TweenInfo.new(0.2), {Position = TargetPos}):Play()
                TweenService:Create(ToggleBtn, TweenInfo.new(0.2), {BackgroundColor3 = TargetColor}):Play()
                
                Callback(Toggled)
            end)
        end

        -- Slider Component
        function TabObj.Slider(Flag, Text, Min, Max, Default, Callback)
            local Card = Create("Frame", {
                Parent = Page,
                BackgroundColor3 = Theme.Card,
                Size = UDim2.new(0.95, 0, 0, 65) -- Taller for slider
            })
            Create("UICorner", { Parent = Card, CornerRadius = UDim.new(0, 6) })
            Create("UIStroke", { Parent = Card, Color = Theme.Stroke, Thickness = 1 })

            local Title = Create("TextLabel", {
                Parent = Card,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 15, 0, 10),
                Size = UDim2.new(1, -30, 0, 20),
                Text = Text,
                TextColor3 = Theme.TextMain,
                Font = Enum.Font.GothamMedium,
                TextSize = 14,
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local ValueLabel = Create("TextLabel", {
                Parent = Card,
                BackgroundTransparency = 1,
                Position = UDim2.new(1, -65, 0, 10),
                Size = UDim2.new(0, 50, 0, 20),
                Text = tostring(Default),
                TextColor3 = Theme.Accent,
                Font = Enum.Font.GothamBold,
                TextSize = 14,
                TextXAlignment = Enum.TextXAlignment.Right
            })

            local SliderBar = Create("Frame", {
                Parent = Card,
                BackgroundColor3 = Theme.TabInactive,
                Position = UDim2.new(0, 15, 0, 40),
                Size = UDim2.new(1, -30, 0, 6)
            })
            Create("UICorner", { Parent = SliderBar, CornerRadius = UDim.new(1, 0) })

            local Fill = Create("Frame", {
                Parent = SliderBar,
                BackgroundColor3 = Theme.Accent,
                Size = UDim2.new((Default - Min) / (Max - Min), 0, 1, 0)
            })
            Create("UICorner", { Parent = Fill, CornerRadius = UDim.new(1, 0) })

            local Knob = Create("Frame", {
                Parent = Fill,
                BackgroundColor3 = Theme.TextMain,
                Size = UDim2.new(0, 14, 0, 14),
                Position = UDim2.new(1, -7, 0.5, -7)
            })
            Create("UICorner", { Parent = Knob, CornerRadius = UDim.new(1, 0) })

            -- Interaction
            local Dragging = false
            
            local function Update(Input)
                local SizeX = math.clamp((Input.Position.X - SliderBar.AbsolutePosition.X) / SliderBar.AbsoluteSize.X, 0, 1)
                Fill.Size = UDim2.new(SizeX, 0, 1, 0)
                local Value = math.floor(Min + ((Max - Min) * SizeX))
                ValueLabel.Text = tostring(Value)
                Callback(Value)
            end

            SliderBar.InputBegan:Connect(function(Input)
                if Input.UserInputType == Enum.UserInputType.MouseButton1 then
                    Dragging = true
                    Update(Input)
                end
            end)

            UserInputService.InputChanged:Connect(function(Input)
                if Dragging and Input.UserInputType == Enum.UserInputType.MouseMovement then
                    Update(Input)
                end
            end)

            UserInputService.InputEnded:Connect(function(Input)
                if Input.UserInputType == Enum.UserInputType.MouseButton1 then Dragging = false end
            end)
        end
        
        -- Textbox Component
        function TabObj.Textbox(Flag, Text, Placeholder, Callback)
            local Card = Create("Frame", {
                Parent = Page,
                BackgroundColor3 = Theme.Card,
                Size = UDim2.new(0.95, 0, 0, 50)
            })
            Create("UICorner", { Parent = Card, CornerRadius = UDim.new(0, 6) })
            Create("UIStroke", { Parent = Card, Color = Theme.Stroke, Thickness = 1 })

            local Title = Create("TextLabel", {
                Parent = Card,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 15, 0, 0),
                Size = UDim2.new(0.5, 0, 1, 0),
                Text = Text,
                TextColor3 = Theme.TextMain,
                Font = Enum.Font.GothamMedium,
                TextSize = 14,
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local BoxContainer = Create("Frame", {
                Parent = Card,
                BackgroundColor3 = Theme.TopBar, -- Darker input bg
                Position = UDim2.new(1, -165, 0.5, -15),
                Size = UDim2.new(0, 150, 0, 30)
            })
            Create("UICorner", { Parent = BoxContainer, CornerRadius = UDim.new(0, 4) })
            Create("UIStroke", { Parent = BoxContainer, Color = Theme.Stroke, Thickness = 1 })

            local Input = Create("TextBox", {
                Parent = BoxContainer,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, -10, 1, 0),
                Position = UDim2.new(0, 5, 0, 0),
                Text = "",
                PlaceholderText = Placeholder,
                TextColor3 = Theme.TextMain,
                PlaceholderColor3 = Theme.TextDim,
                Font = Enum.Font.Gotham,
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Left
            })
            
            Input.FocusLost:Connect(function(enter)
                if enter then Callback(Input.Text) end
            end)
        end
        
        -- Dropdown Component
        function TabObj.Dropdown(Flag, Text, Options, Callback)
            -- Note: Simplified dropdown for compactness
            local Expanded = false
            local DropdownSize = 34 * (#Options + 1)
            
            local Card = Create("Frame", {
                Parent = Page,
                BackgroundColor3 = Theme.Card,
                Size = UDim2.new(0.95, 0, 0, 50),
                ClipsDescendants = true
            })
            Create("UICorner", { Parent = Card, CornerRadius = UDim.new(0, 6) })
            Create("UIStroke", { Parent = Card, Color = Theme.Stroke, Thickness = 1 })
            
            local Title = Create("TextLabel", {
                Parent = Card,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 15, 0, 0),
                Size = UDim2.new(0.5, 0, 0, 50),
                Text = Text,
                TextColor3 = Theme.TextMain,
                Font = Enum.Font.GothamMedium,
                TextSize = 14,
                TextXAlignment = Enum.TextXAlignment.Left
            })
            
            local DisplayText = Create("TextLabel", {
                Parent = Card,
                BackgroundTransparency = 1,
                Position = UDim2.new(1, -165, 0, 10),
                Size = UDim2.new(0, 150, 0, 30),
                Text = "Select...",
                TextColor3 = Theme.Accent,
                Font = Enum.Font.GothamBold,
                TextSize = 14,
                TextXAlignment = Enum.TextXAlignment.Right
            })
            
            local Trigger = Create("TextButton", {
                Parent = Card,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, 50),
                Text = ""
            })
            
            -- Option List
            local List = Create("Frame", {
                Parent = Card,
                BackgroundColor3 = Theme.TopBar,
                Position = UDim2.new(0, 15, 0, 50),
                Size = UDim2.new(1, -30, 0, #Options * 30),
                Visible = true
            })
            Create("UICorner", { Parent = List, CornerRadius = UDim.new(0, 4) })
            
            local OptionLayout = Create("UIListLayout", { Parent = List, SortOrder = Enum.SortOrder.LayoutOrder })
            
            for _, opt in pairs(Options) do
                local OptBtn = Create("TextButton", {
                    Parent = List,
                    BackgroundTransparency = 1,
                    Size = UDim2.new(1, 0, 0, 30),
                    Text = opt,
                    TextColor3 = Theme.TextDim,
                    Font = Enum.Font.Gotham,
                    TextSize = 13
                })
                OptBtn.MouseButton1Click:Connect(function()
                    DisplayText.Text = opt
                    Callback(opt)
                    Expanded = false
                    TweenService:Create(Card, TweenInfo.new(0.2), {Size = UDim2.new(0.95, 0, 0, 50)}):Play()
                end)
            end
            
            Trigger.MouseButton1Click:Connect(function()
                Expanded = not Expanded
                local TargetSize = Expanded and UDim2.new(0.95, 0, 0, 50 + (#Options * 30) + 10) or UDim2.new(0.95, 0, 0, 50)
                TweenService:Create(Card, TweenInfo.new(0.2), {Size = TargetSize}):Play()
            end)
        end
        
        -- Button Component
        function TabObj.Button(Text, Callback)
            local Card = Create("Frame", {
                Parent = Page,
                BackgroundColor3 = Theme.Card,
                Size = UDim2.new(0.95, 0, 0, 40)
            })
            Create("UICorner", { Parent = Card, CornerRadius = UDim.new(0, 6) })
            
            local Btn = Create("TextButton", {
                Parent = Card,
                BackgroundColor3 = Theme.Accent,
                Size = UDim2.new(1, 0, 1, 0),
                Text = Text,
                TextColor3 = Color3.new(1,1,1),
                Font = Enum.Font.GothamBold,
                TextSize = 14,
                AutoButtonColor = true
            })
            Create("UICorner", { Parent = Btn, CornerRadius = UDim.new(0, 6) })
            
            Btn.MouseButton1Click:Connect(Callback)
        end

        return TabObj
    end
    
    return Library
end

return Spawn